浏览器缓存机制
---

### 缓存过程分析

浏览器和服务器通信是应答模式 即 "浏览器发起请求" ——> "服务器响应该请求"

浏览器拿到第一次请求从服务器返回的结果 根据响应报文中HTTP响应头中的缓存表示决定是否缓存该结果

![缓存过程分析图]("https://segmentfault.com/img/remote/1460000021060750/view")

上图得知:

浏览器每次发起请求都会去浏览器缓存中查找改请求的缓存标识和缓存结果

浏览器每次请求拿到的响应结果都会将该结果和缓存标识存到浏览器缓存中

### 缓存规则 

根据是否重新向服务器发起HTTP请求将缓存过程分为两个部分 强缓存 协商缓存

#### 强制缓存规则是什么

当浏览器向服务器发送请求时 服务器会将缓存规则放到HTTP响应头中同返回结果一起返回给浏览器 控制强制的两个字段分别为 `Exprise` `Cache-Contorl`  `Cache-Contorl`的优先级比前高

`Exprise` 控制缓存的原理是通过浏览器时间和服务器时间做对比 如果两者的时间因为某种原因对不上 会导致强制缓存失效 

`Cache-Contorl`取值

`public`：所有内容都将被缓存（客户端和代理服务器都可缓存）。

`private`：所有内容只有客户端可以缓存，Cache-Control 的默认取值。

`no-cache`：客户端缓存内容，但是是否使用缓存则需要经过协商缓存来验证决定。

`no-store`：所有内容都不会被缓存，即不使用强制缓存，也不使用协商缓存。

`max-age=xxx` (`xxx is numeric`)：缓存内容将在 xxx 秒后失效。

强制缓存状态置灰的请求对应的`size`位置表示缓存存放地址 分别为`from memory cache` 和 `from disk cache`  读取顺序     `memory` -> `disk`

`from memory cache` 是从内存中读取缓存

`from disk cache` 是从硬盘中读取缓存

强制缓存的情况主要有三种:

1.不存在缓存结果和缓存标识 强制缓存失效 则向服务器发起请求(跟第一次发起请求一致)

![强制缓存失效]("https://segmentfault.com/img/remote/1460000021060749/view")

2.存在缓存结果和缓存标识 但改结果失效了 强制缓存失效 则使用协商缓存

![强制缓存失效]("https://segmentfault.com/img/remote/1460000021060751/view")

3.存在缓存结果和缓存标识 且缓存结果未失效 强制缓存生效 直接返回结果

![强制缓存生效]("https://segmentfault.com/img/remote/1460000021060752/view")

#### 协商缓存

协商缓存是当强制缓存失效后 带着缓存标识向服务器发起请求 有服务器根据缓存标识决定是否使用缓存的过程

